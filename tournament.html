<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tournament</title>

<style>
body{
 font-family:sans-serif;
 background:#f4f4f4;
 padding:20px;
 margin-bottom:80px;
}
.container{max-width:900px;margin:auto;}
.section{display:none;background:white;padding:15px;margin-bottom:20px;border-radius:8px;}
.section.active{display:block;}
table{width:100%;border-collapse:collapse;}
th,td{border:1px solid #ccc;padding:8px;text-align:center;}
.round-card{background:#eee;padding:15px;margin-bottom:20px;border-radius:8px;}
.match-card{background:white;padding:10px;margin:10px 0;border-radius:5px;display:flex;justify-content:space-around;}
.add-match-btn{background:#2ecc71;color:white;border:none;padding:10px 15px;border-radius:5px;}
.navbar{position:fixed;bottom:0;left:0;right:0;background:#2c3e50;display:flex;justify-content:space-around;padding:15px 0;}
.nav-item{color:white;font-weight:bold;cursor:pointer;}
.nav-item.active{color:#2ecc71;}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);}
.modal-content{background:white;padding:20px;width:90%;max-width:400px;margin:100px auto;border-radius:8px;}
select,input{width:100%;padding:10px;margin:10px 0;}
</style>

</head>

<body>

<div class="container">

<h1 id="title"></h1>

<div id="fixtures" class="section active">
<h2>Fixtures</h2>
<button class="add-match-btn" onclick="openMatchModal()">+ Add Match</button>
<div id="fixturesList"></div>
</div>

<div id="scores" class="section">
<h2>Scores</h2>
</div>

<div id="table" class="section">
<h2>Table</h2>
<table>
<thead><tr><th>Team</th><th>Points</th></tr></thead>
<tbody id="standings"></tbody>
</table>
</div>

</div>

<nav class="navbar">
<div class="nav-item active" onclick="showSection('fixtures',this)">Fixtures</div>
<div class="nav-item" onclick="showSection('scores',this)">Scores</div>
<div class="nav-item" onclick="showSection('table',this)">Table</div>
</nav>

<div id="matchModal" class="modal">
<div class="modal-content">
<h3>Add Match</h3>
<input type="number" id="roundInput" value="1">
<select id="homeTeamSelect"></select>
<select id="awayTeamSelect"></select>
<button onclick="closeMatchModal()">Cancel</button>
<button onclick="saveMatch()">Save</button>
</div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore,doc,onSnapshot,updateDoc,arrayUnion } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig={
 apiKey:"AIzaSyBYFoGEfyxSc_8h_GryQ4HXk9UDZf6I9Vc",
 authDomain:"football-manager-a8c11.firebaseapp.com",
 projectId:"football-manager-a8c11",
 storageBucket:"football-manager-a8c11.firebasestorage.app",
 messagingSenderId:"78452499051",
 appId:"1:78452499051:web:5f26427727d1d17024c72e"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

const title=document.getElementById("title");
const standings=document.getElementById("standings");
const fixturesList=document.getElementById("fixturesList");
const homeTeamSelect=document.getElementById("homeTeamSelect");
const awayTeamSelect=document.getElementById("awayTeamSelect");
const matchModal=document.getElementById("matchModal");
const roundInput=document.getElementById("roundInput");

const id=new URLSearchParams(location.search).get("id");
const ref=doc(db,"tournaments",id);

let tournament=null;

onSnapshot(ref,snap=>{
 if(!snap.exists())return;
 tournament=snap.data();
 render();
});

function render(){

title.innerText=tournament.name;

standings.innerHTML="";
tournament.teams.forEach(t=>{
 standings.innerHTML+=`<tr><td>${t}</td><td>0</td></tr>`;
});

fixturesList.innerHTML="";

if(tournament.matches){
 const rounds={};
 tournament.matches.forEach(m=>{
  if(!rounds[m.round])rounds[m.round]=[];
  rounds[m.round].push(m);
 });

 Object.keys(rounds).sort((a,b)=>a-b).forEach(r=>{
  let h=`<div class="round-card"><h3>Round ${r}</h3>`;
  rounds[r].forEach(m=>{
   h+=`<div class="match-card">${m.home} vs ${m.away}</div>`;
  });
  h+="</div>";
  fixturesList.innerHTML+=h;
 });
}

homeTeamSelect.innerHTML="";
awayTeamSelect.innerHTML="";

tournament.teams.forEach(t=>{
 homeTeamSelect.innerHTML+=`<option>${t}</option>`;
 awayTeamSelect.innerHTML+=`<option>${t}</option>`;
});

}

window.showSection=(id,e)=>{
 document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
 document.getElementById(id).classList.add("active");
 document.querySelectorAll(".nav-item").forEach(n=>n.classList.remove("active"));
 e.classList.add("active");
};

window.openMatchModal=()=>matchModal.style.display="block";
window.closeMatchModal=()=>matchModal.style.display="none";

window.saveMatch=async()=>{

 if(homeTeamSelect.value===awayTeamSelect.value){
   alert("Same team selected");
   return;
 }

 await updateDoc(ref,{
  matches:arrayUnion({
   id:crypto.randomUUID(),
   round:+roundInput.value,
   home:homeTeamSelect.value,
   away:awayTeamSelect.value,
   scoreHome:null,
   scoreAway:null
  })
 });

 closeMatchModal();
};

</script>

</body>
 </html>
